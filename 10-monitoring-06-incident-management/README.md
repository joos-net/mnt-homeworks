# Домашнее задание к занятию 17 «Инцидент-менеджмент»

## Задание

Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

Информацию о сбое можно изучить по ссылкам ниже:

* [краткое описание на русском языке](https://habr.com/ru/post/427301/);
* [развёрнутое описание на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

# Постмортем

## Краткое описание инцидента
Снижение качества обслуживания на 24 часа и 11 минут - GitHub не мог обслуживать события или создавать и публиковать сайты GitHub Pages.

## Предшествующие события
В 22:52 UTC 21 октября плановые работы по техническому обслуживанию, для замены вышедшего из строя оптического оборудования, которые привели к потере связи между центрами обработки данных

## Причина инцидента
Во время сетевой недоступности, Orchestrator, начал процесс выбора мастера в соответствии с консенсусом Raft. Центры обработки данных на Западном побережье и узлы управления общедоступными облаками на Восточном побережье смогли установить кворум. Когда подключение было восстановлено, на серверах баз данных в центре обработки данных Восточного побережья содержались кратковременные записи, которые не были реплицированы на Западном побережье. Поскольку кластеры баз данных в обоих центрах обработки данных теперь содержали записи, которых не было в другом центре обработки данных, мы не смогли безопасно вернуть первичный сервер обратно в центр обработки данных на Восточном побережье.

## Воздействие
Топология для многочисленных кластеров баз данных находятся в неподходящем состоянии. Запрос API Orchestrator показал топологию репликации базы данных, которая включала только серверы из центра обработки данных на Западном побережье.

## Обнаружение
- 21 октября 2018 22:54 UTC
  - Внутренние системы мониторинга начали генерировать оповещения, указывающие на многочисленные сбои в системах. В это время несколько инженеров отвечали и работали над сортировкой входящих уведомлений

## Реакция
- 21 октября 2018
  - В 23:07 UTC команда реагирования решила вручную заблокировать внутренний инструмент развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений.
  - В 23:09 UTC команда реагирования перевела сайт в желтый статус. Это действие автоматически перевело ситуацию в активный инцидент и отправило предупреждение координатору инцидента.
  - В 23:11 UTC присоединился координатор инцидента и двумя минутами позже изменил состояние на красный статус.

## Восстановление
- 22 октября 2018 00:05 UTC
  - Инженеры, участвующие в группе реагирования на инциденты, приступили к разработке плана устранения несоответствия данных и реализации процедур обработки отказа MySQL. План состоял в том, чтобы восстановить данные из резервных копий, синхронизировать реплики на обоих сайтах, вернуться к стабильной топологии обслуживания, а затем возобновить обработку заданий, поставленных в очередь.
- 22 октября 2018 00:41 UTC
  - К этому времени был запущен процесс резервного копирования для всех затронутых кластеров MySQL, и инженеры отслеживали прогресс. 
- 22 октября 2018, 06:51 UTC
  - Несколько кластеров завершили восстановление из резервных копий в центре обработки данных на Восточном побережье и начали реплицировать новые данные с Западного побережья.
- 22 октября 2018 11:12 UTC
  - Все первичные базы данных снова были установлены на Восточном побережье.
- 22 октября 2018 23:03 UTC
  - Все ожидающие сборки webhooks и Pages были обработаны, и целостность и надлежащая работа всех систем были подтверждены.


## Таймлайн
- 21 октября 2018 22:54 UTC
  - Системы мониторинга начали генерировать оповещения
- 21 октября 2018 23:07 UTC
  - Команда реагирования решила вручную заблокировать внутренний инструмент развертывания
- 21 октября 2018 23:09 UTC
  - Команда реагирования перевела сайт в желтый статус
- 21 октября 2018 23:11 UTC
  - Координатор инцидента изменил решение на красный статус.
- 21 октября 2018 23:13 UTC
  - Были вызваны дополнительные инженеры из команды разработчиков баз данных GitHub.
- 21 октября 2018 23:19 UTC
  - Было прекращено выполнение заданий, которые записывают метаданные
- 22 октября 2018 00:05 UTC
  - Инженеры приступили к разработке плана устранения несоответствий данных
- 22 октября 2018 00:41 UTC
  - Запущен процесс резервного копирования для всех затронутых кластеров MySQL
- 22 октября 2018, 06:51 UTC
  - Несколько кластеров завершили восстановление из резервных копий и начали реплицировать новые данные
- 22 октября 2018, 07:46 UTC
  - GitHub опубликовал запись в блоге, чтобы предоставить больше информации об инцеденте.
- 22 октября 2018 11:12 UTC
  - Все первичные базы данных снова были установлены на Восточном побережье США.
- 22 октября 2018 13:15 UTC
  - Ожидание пиковой нагрузке на трафик и обсуждение того, как действовать дальше.
- 22 октября 2018 16:24 UTC
  - Реплики были синхронизированы, выполнен переход на исходную топологию, решив проблемы с задержкой / доступностью.
- 22 октября 2018 16:45 UTC
  - Балансировка возросшей нагрузку, связанную с невыполненной работой.
- 22 октября 2018 23:03 UTC
 - Все ожидающие сборки webhooks и Pages были обработаны, целостность и надлежащая работа всех систем были подтверждены.

## Последующие действия
1. Изменение конфигурации Orchestrator, чтобы предотвратить распространение первичных баз данных через региональные границы. 
2. Переход на новый механизм отчетов о состоянии, который предоставит большую наглядность для обсуждения активных инцидентов более четким языком. Изменение статусов с только зеленый, желтый и красный. 
3. Инициатива по поддержке обслуживания трафика GitHub из нескольких центров обработки данных. Цель проекта - поддерживать резервирование N + 1 на уровне объекта. Цель работы - допустить полный отказ одного центра обработки данных без воздействия на пользователя. 


